---
title: "Final project!"
subtitle: "Modern music and pop!"
author: "My team"
date: "2019/06/20"
output:
  xaringan::moon_reader:
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---

class: middle

#발표 개요

1. 분석 주제 설명

2. 크롤링 과정&데이터 불러오기

3. 워드클라우드 생성 과정

4. 이모티콘 분석 과정

---

#1. 분석 주제

현대 음악(20세기 음악)과 팝 음악에 대한 대중 차이 반응 비교
:유튜브 댓글 비교 분석

---

#2. 크롤링 과정
Rselenium 패키지 활용!

_사전작업 필요_
참조 : 
https://blog.naver.com/najam90/221176101881


```{r, include = FALSE}
library(tidyverse)
library(httr)
library(rvest)
library(RSelenium)
library(stringr)
```

Step.1) 브라우져 열기&링크 이동
remDr<-remoteDriver(remoteServerAddr="localhost",
                    port=4445L,
                    browserName="chrome")
remDr$open()

remDr$navigate("https://www.youtube.com/watch?time_continue=1&v=Jyf64r4KvaI")

step.2) 댓글 크롤링

url_source<-remDr$getPageSource()[[1]]

url_item<-read_html(url_source, encoding="UTF-8") 

mahler<- url_item %>% 
  html_nodes("yt-formatted-string#content-text.style-scope.ytd-comment-renderer") %>% 
  html_text(trim=TRUE)

**시연 불가능...**

---
#자료 유튜브 링크 - Modern

```{r, echo = FALSE}

DT::datatable(
  
  data.frame( 
  Composer = c("Malher", "Strauss", "Debussy", "Ravel", "Schonberg", "Ives",
               "Stravinsky", "Prokofiev","Kodaly","Vares"),
  Title = c("피아노 4중주 가단조", "돈키호테", "달빛","볼레로","피아노 모음곡 중 지그",
           "대답 없는 질문","페트루슈카", "피터와 늑대", "첼로 소나타 1악장",
           "전자시대의 시"),
  Link = c("https://www.youtube.com/watch?time_continue=1&v=Jyf64r4KvaI",
           "https://www.youtube.com/watch?time_continue=760&v=dJNEuvfeshg",
           "https://www.youtube.com/watch?v=U3u4pQ4WKOk",
           "https://www.youtube.com/watch?v=dZDiaRZy0Ak",
           "https://www.youtube.com/watch?v=bQHR_Z8XVvI",
           "https://www.youtube.com/watch?v=KYug4df2Yf0",
           "https://www.youtube.com/watch?time_continue=1740&v=esD90diWZds",
           "https://www.youtube.com/watch?v=MfM7Y9Pcdzw",
           "https://www.youtube.com/watch?time_continue=229&v=u7-fXgwSKRw",
           "https://www.youtube.com/watch?time_continue=1&v=WQKyYmU2tPg")
  ), options = list(pageLength = 5)
  
)


```

---

#자료 유튜브 링크 - Pop

```{r, echo = FALSE}

DT::datatable(
  
  data.frame( 
  Composer = c("BTS", "Lil Nas", "Taylor Swift", "Post Malone", "Jonas Brothers",
               "Post Malone & Swae Less", "Ariana Grande", "Halsey",
               "Sam Smith & Normani","Billie Eilsh"),
  Title = c("작은 것들을 위한 시", "Old Town Road", "ME!","Wow","Sucker",
           "sunflower","7 Rings", "Without Me", "Dancing with a Stranger",
           "Bad guy"),
  Link = c("https://www.youtube.com/watch?v=XsX3ATc3FbA",
           "https://www.youtube.com/watch?v=w2Ov5jzm3j8",
           "https://www.youtube.com/watch?v=FuXNumBwDOM",
           "https://www.youtube.com/watch?v=393C3pr2ioY",
           "https://www.youtube.com/watch?v=CnAmeh0-E-U",
           "https://www.youtube.com/watch?v=3E78T8h5EhA",
           "https://www.youtube.com/watch?v=QYh6mYIJG2Y",
           "https://www.youtube.com/watch?v=ZAfAud_M_mg",
           "https://www.youtube.com/watch?v=av5JD1dfj_c",
           "https://www.youtube.com/watch?v=DyDfgMOUjCI")
  ), 
  options = list(pageLength = 5)
  
)


```

---

#Data 불러오기
```{r, include=FALSE }
library(RCurl)
```

```{r, message=FALSE, warning=FALSE }
Modern <- read_csv(
  getURL("https://raw.githubusercontent.com/Doolhead/Final-Project-DS/master/Modern.csv")
  , col_names=TRUE, skip_empty_rows = TRUE)
Pop <- read_csv(
  getURL("https://raw.githubusercontent.com/Doolhead/Final-Project-DS/master/Pop.csv")
  , col_names=TRUE, skip_empty_rows = TRUE)
```
-예시
```{r, message=FALSE, warning=FALSE, echo=FALSE}

knitr::kable(Modern[1:3,], format = 'html')

```

---

#Data 전처리


```{r}
modern <- Modern

#1. Enter 제거
modern$Text <- str_replace_all(modern$Text, "\n", " ")

#2. "" 제거
modern$Text <- str_replace_all(modern$Text, '"', "'")

#3. 인코딩 표시 제거
modern$Text <- chartr("+", "a", modern$Text) 
modern$Text <- modern$Text %>%
  str_remove_all(pattern = "<\\w+>")

#4. 이름 태그 제거
modern$Text <- modern$Text %>%
  str_remove(pattern = "@\\w+")

#5. 숫자 제거
modern$Text <- modern$Text %>%
  str_remove_all(pattern = "\\d+")
```

```{r, include=FALSE}
pop <- Pop

#1. Enter 제거
pop$Text <- str_replace_all(pop$Text, "\n", " ")

#2. "" 제거
pop$Text <- str_replace_all(pop$Text, '"', "'")

#3. 인코딩 표시 제거
pop$Text <- chartr("+", "a", pop$Text) 
pop$Text <- pop$Text %>%
  str_remove_all(pattern = "<\\w+>")

#4. 이름 태그 제거
pop$Text <- pop$Text %>%
  str_remove(pattern = "@\\w+")

#5. 숫자 제거
pop$Text <- pop$Text %>%
  str_remove_all(pattern = "\\d+")
```

---

#3.워드 클라우드 생성!
-20세기 음악
```{r, include=FALSE}
library(wordcloud2)
library(tidytext)
library(dplyr)
```

```{r, warning = FALSE, message=FALSE,result="hide"}
modern_text_df <- tibble(text = modern$Text)
m.corpus_text <- modern_text_df %>%  unnest_tokens(word, text)
m.corpus_clean <- m.corpus_text %>%  anti_join(stop_words)
m.count_text <- m.corpus_clean %>%  count(word, sort=TRUE)

wm<-wordcloud2(m.count_text, minSize = 10, shape='pentagon')

###

pop_text_df <- tibble(text = pop$Text)
p.corpus_text <- pop_text_df %>%  unnest_tokens(word, text)
p.corpus_clean <- p.corpus_text %>%  anti_join(stop_words)
p.count_text <- p.corpus_clean %>%  count(word, sort=TRUE)

wp<-wordcloud2(p.count_text, minSize = 10, shape='pentagon')
```

---
.pull-left[
modern
```{r}

wordcloud2(m.count_text, minSize = 10, shape='pentagon')
```
]

.pull-rigth[
pop
```{r}

wordcloud2(p.count_text, minSize = 10, shape='pentagon')
```
]


---


#4. 이모티콘 분석!

참조 : https://github.com/today-is-a-good-day/emojis/blob/master/scrapeEmoticons.R

Step.1) 이모티콘 사전 구성!
=> 웹 자료 다운!(http://apps.timwhitlock.info/emoji/tables/unicode)

```{r, include=FALSE}
library(httr)
library(rvest)
```

```{r}
url <- "http://apps.timwhitlock.info/emoji/tables/unicode"
emoticons <- url %>%
  read_html(fileEncoding="UTF-8", encoding='latin1') %>%
  html_nodes(xpath='/html/body/div[2]/div/div/table[1]') %>%
  html_table()
emoticons <- data.frame(emoticons[[1]]$Unicode, 
                        emoticons[[1]]$Description, stringsAsFactors = FALSE)
names(emoticons) <- c("Unicode", "Description")

##유형별 이모티콘 테이블 모두 취합! => allemoji
```

```{r, include=FALSE}

#dingbats
dingbats <- url %>%
  read_html(fileEncoding="UTF-8", encoding='latin1') %>%
  html_nodes(xpath='/html/body/div[2]/div/div/table[2]') %>%
  html_table()
dingbats <- data.frame(dingbats[[1]]$Unicode, 
                       dingbats[[1]]$Description, stringsAsFactors = FALSE)
names(dingbats) <- c("Unicode", "Description")

#transport
transport <- url %>%
  read_html(fileEncoding="UTF-8", encoding='latin1') %>%
  html_nodes(xpath='/html/body/div[2]/div/div/table[3]') %>%
  html_table()
transport <- data.frame(transport[[1]]$Unicode, 
                        transport[[1]]$Description, stringsAsFactors = FALSE)
names(transport) <- c("Unicode", "Description")

#enclosed
enclosed <- url %>%
  read_html(fileEncoding="UTF-8", encoding='latin1') %>%
  html_nodes(xpath='/html/body/div[2]/div/div/table[4]') %>%
  html_table()
enclosed <- data.frame(enclosed[[1]]$Unicode, 
                       enclosed[[1]]$Description, stringsAsFactors = FALSE)
names(enclosed) <- c("Unicode", "Description")
enclosed<-enclosed[-which(str_count(enclosed$Unicode, pattern="U")>1),]

#uncategorized
uncategorized <- url %>%
  read_html(fileEncoding="UTF-8", encoding='latin1') %>%
  html_nodes(xpath='/html/body/div[2]/div/div/table[5]') %>%
  html_table()
uncategorized <- data.frame(uncategorized[[1]]$Unicode, 
                            uncategorized[[1]]$Description, stringsAsFactors = FALSE)
names(uncategorized) <- c("Unicode", "Description")
uncategorized<-uncategorized[-which(str_count(uncategorized$Unicode, pattern="U")>1),]

#addemoticons
addemoticons <- url %>%
  read_html(fileEncoding="UTF-8", encoding='latin1') %>%
  html_nodes(xpath='/html/body/div[2]/div/div/table[6]') %>%
  html_table()
addemoticons <- data.frame(addemoticons[[1]]$Unicode, 
                           addemoticons[[1]]$Description, stringsAsFactors = FALSE)
names(addemoticons) <- c("Unicode", "Description")

#addtransport
addtransport <- url %>%
  read_html(fileEncoding="UTF-8", encoding='latin1') %>%
  html_nodes(xpath='/html/body/div[2]/div/div/table[7]') %>%
  html_table()
addtransport <- data.frame(addtransport[[1]]$Unicode, 
                           addtransport[[1]]$Description, stringsAsFactors = FALSE)
names(addtransport) <- c("Unicode", "Description")

#addothers
addothers <- url %>%
  read_html(fileEncoding="UTF-8", encoding='latin1') %>%
  html_nodes(xpath='/html/body/div[2]/div/div/table[8]') %>%
  html_table()
addothers <- data.frame(addothers[[1]]$Unicode, 
                        addothers[[1]]$Description, stringsAsFactors = FALSE)
names(addothers) <- c("Unicode", "Description")

#union!!
allemoji <-  bind_rows(list(emoticons, addemoticons, dingbats, transport, 
                            addtransport, enclosed, uncategorized, addothers))

```

---

#자료에서 이모티콘 추출!

```{r}
#이모티콘은 text 내에서 유니코드로 적혀짐!(U+1F601 , U+1F602 등등...)
#=>해당 형식의 문자 추출!
#Modern_emoji
m.which<-grep(Modern$Text, pattern="<U\\+")
uni.m <- str_extract_all(Modern$Text[m.which], pattern="<U\\+\\w+>")
emo.m <- data.frame(table(unlist(uni.m)))
names(emo.m)<- c("Unicode", "Freq")
#사전에선 U+1F601인 코드가 텍스트에선 U+0001F601인 경우가 있어 수정!
emo.m$Unicode <- emo.m$Unicode %>%
  str_remove_all(pattern="<|>")%>%
  str_replace(pattern ="\\+000", replacement = "\\+")
#이모티콘 사전과 병합!
eMat.m <- inner_join(allemoji, emo.m, by='Unicode')
eMat.m <- arrange(eMat.m, desc(Freq))

```

```{r, include=FALSE}
#Pop_emoji
Pop$Text<-str_remove_all(Pop$Text, pattern="<U\\+FEFF>")
p.which<-grep(Pop$Text, pattern="<U\\+")
uni.p <- str_extract_all(Pop$Text[p.which], pattern="<U\\+\\w+>")
emo.p <- data.frame(table(unlist(uni.p)))
names(emo.p)<- c("Unicode", "Freq")
emo.p$Unicode <- emo.p$Unicode %>%
  str_remove_all(pattern="<|>")%>%
  str_replace(pattern ="\\+000", replacement = "\\+")
eMat.p<-inner_join(allemoji, emo.p, by='Unicode')
eMat.p <- arrange(eMat.p, desc(Freq))
```

---
#그래프!

```{r, message=FALSE, warning=FALSE, results="hide"}
library(tibble)
library(emojifont)
list.emojifonts()
load.emojifont("OpenSansEmoji.ttf")
load.emojifont("EmojiOne.ttf")
library(emoGG)
```

library(devtools)
devtools::install_github('dill/emoGG', force =TRUE )
=>library(emoGG) 가 안될 시 해당 파일 다운 필요.

```{r}

eMat.m<-data.frame(eMat.m, Rank=1:length(eMat.m$Unicode))
em.m<-str_to_lower(
  str_remove(eMat.m$Unicode[1:10], pattern="U\\+")
) 
g<-ggplot(eMat.m[1:10,], aes(x=Rank, y=Freq))+
  geom_bar(stat = 'identity',fill = 'dodgerblue4')+
  geom_emoji(data=eMat.m[1,], emoji='1f44f', size=0.09)+
  geom_emoji(data=eMat.m[2,], emoji='1f602', size=0.09)+
  geom_emoji(data=eMat.m[3,], emoji='2764', size=0.09)+
  geom_emoji(data=eMat.m[4,], emoji='1f60d', size=0.09)+
  geom_emoji(data=eMat.m[5,], emoji='1f62d', size=0.09)+
  geom_emoji(data=eMat.m[6,], emoji='1f3b6', size=0.09)+
  geom_emoji(data=eMat.m[7,], emoji='1f44d', size=0.09)+
  geom_emoji(data=eMat.m[8,], emoji='1f495', size=0.09)+
  geom_emoji(data=eMat.m[9,], emoji='1f631', size=0.09)+
  geom_emoji(data=eMat.m[10,], emoji='1f428', size=0.09)

```

---

```{r}
#emoticon bar plot!
g

```

```{r, include = FALSE}
eMat.p<-data.frame(eMat.p, Rank=1:length(eMat.p$Unicode))

em.p<-str_to_lower(
  str_remove(eMat.p$Unicode[1:10], pattern="U\\+")
)
em.p
ggplot(eMat.p[1:10,], aes(x=Rank, y=Freq))+
  geom_bar(stat = 'identity',fill = 'dodgerblue4')+
  geom_emoji(data=eMat.p[1,], emoji='2764', size=0.09)+
  geom_emoji(data=eMat.p[2,], emoji='1f60d', size=0.09)+
  geom_emoji(data=eMat.p[3,], emoji='1f602', size=0.09)+
  geom_emoji(data=eMat.p[4,], emoji='1f525', size=0.09)+
  geom_emoji(data=eMat.p[5,], emoji='1f618', size=0.09)+
  geom_emoji(data=eMat.p[6,], emoji='1f495', size=0.09)+
  geom_emoji(data=eMat.p[7,], emoji='1f49c', size=0.09)+
  geom_emoji(data=eMat.p[8,], emoji='1f62d', size=0.09)+
  geom_emoji(data=eMat.p[9,], emoji='1f33b', size=0.09)+
  geom_emoji(data=eMat.p[10,], emoji='1f44d', size=0.09)

```






